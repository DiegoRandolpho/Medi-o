<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VUX Control - Medições</title>
    <link rel="icon" href="data:,"> <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { background: radial-gradient(circle at top left, #1e293b, #0f172a); min-height: 100vh; color: white; font-family: sans-serif; }
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; }
        .glass-nav { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border-right: 1px solid rgba(255, 255, 255, 0.1); }
        .btn-primary { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); transition: all 0.2s; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4); }
        input[type="file"]::file-selector-button { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 4px 12px; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Acessando as bibliotecas através do escopo global window
        const { useState, useEffect } = React;
        const { createClient } = window.supabase;

        // --- CONFIGURAÇÃO (SUBSTITUA PELOS SEUS DADOS) ---
        const SUPABASE_URL = 'https://SUA_URL.supabase.co';
        const SUPABASE_KEY = 'SUA_KEY';
        const MAPBOX_TOKEN = 'SEU_TOKEN_MAPBOX';
        // ------------------------------------------------

        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        function App() {
            const [activeTab, setActiveTab] = useState('medicao');
            const [medicoes, setMedicoes] = useState([]);
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                lucide.createIcons();
                carregarDados();
            }, [activeTab]);

            async function carregarDados() {
                setLoading(true);
                const { data, error } = await supabase
                    .from('producao')
                    .select('*, parametro_usinas(filial_puzl), concessao(valor_fixo_km)');
                
                if (data) setMedicoes(data);
                setLoading(false);
            }

            const formatKM = (val) => val ? `${val}` : "0"; // Apenas o número para cópia

            return (
                <div className="flex min-h-screen">
                    {/* Sidebar */}
                    <nav className="w-64 glass-nav p-6 flex flex-col gap-4">
                        <div className="text-xl font-bold mb-8 flex items-center gap-2">
                            <i data-lucide="shield-check" className="text-blue-400"></i> VUX Control
                        </div>
                        
                        <button onClick={() => setActiveTab('medicao')} className={`flex items-center gap-3 p-3 rounded-xl transition ${activeTab === 'medicao' ? 'bg-blue-600 shadow-lg' : 'hover:bg-white/5'}`}>
                            <i data-lucide="table-2"></i> Medições
                        </button>
                        <button onClick={() => setActiveTab('parametros')} className={`flex items-center gap-3 p-3 rounded-xl transition ${activeTab === 'parametros' ? 'bg-blue-600 shadow-lg' : 'hover:bg-white/5'}`}>
                            <i data-lucide="settings"></i> Parâmetros
                        </button>
                    </nav>

                    {/* Conteúdo */}
                    <main className="flex-1 p-8">
                        {activeTab === 'medicao' ? (
                            <div className="animate-in fade-in duration-500">
                                <div className="flex justify-between items-center mb-8">
                                    <h2 className="text-3xl font-bold">Acompanhamento de Produção</h2>
                                    <div className="flex gap-4 items-center">
                                        <label className="text-sm bg-white/5 p-2 rounded-lg border border-white/10">
                                            Importar Produção: 
                                            <input type="file" className="ml-2 text-xs" />
                                        </label>
                                        <button className="btn-primary px-6 py-2 rounded-lg font-bold">Fechar Período</button>
                                    </div>
                                </div>

                                <div className="glass-card overflow-hidden">
                                    <table className="w-full text-left">
                                        <thead>
                                            <tr className="bg-white/5 text-slate-400 text-xs uppercase">
                                                <th className="p-4">Data</th>
                                                <th className="p-4">Placa</th>
                                                <th className="p-4">Filial</th>
                                                <th className="p-4">Volume</th>
                                                <th className="p-4">KM (Mapbox)</th>
                                                <th className="p-4">Total (R$)</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-white/5">
                                            {medicoes.map((m, i) => (
                                                <tr key={i} className="hover:bg-white/5 transition-colors">
                                                    <td className="p-4">{new Date(m.data_servico).toLocaleDateString('pt-BR')}</td>
                                                    <td className="p-4 font-mono">{m.equipamento}</td>
                                                    <td className="p-4">{m.parametro_usinas?.filial_puzl}</td>
                                                    <td className="p-4">{m.volume} m³</td>
                                                    <td className="p-4 text-emerald-400 font-bold">{formatKM(m.distancia_km)}</td>
                                                    <td className="p-4 font-bold">R$ {(m.volume * (m.concessao?.valor_fixo_km || 0) * m.distancia_km).toFixed(2)}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                {['Usinas', 'Placas', 'Concessões', 'Adicionais', 'Terceiros'].map(p => (
                                    <div key={p} className="glass-card p-6 hover:bg-white/10 cursor-pointer transition">
                                        <h3 className="text-xl font-bold mb-2">{p}</h3>
                                        <p className="text-slate-400 text-sm">Gerenciar dados da tabela de {p.toLowerCase()}.</p>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
